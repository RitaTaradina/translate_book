# 10.3 Установка и тестирование драйверов камеры ROS

Если вы этого еще не сделали, установите драйвер

#### _10.3.1 Установка драйверов ROS OpenNI и OpenKinect \(freenect\)_

Чтобы установить драйверы ROS openni и freenect, выполните команду:

```text
$ sudo apt-get install ros-indigo-openni-* ros-indigo-openni2-* \ ros-indigo-freenect-*
$ rospack profile
```

Это все, что нужно сделать!

#### _10.3.2 Установка драйвера веб-камеры_

Существует множество возможных драйверов ROS для веб-камер. Официальный пакет драйверов - [libuvc\_camera](http://wiki.ros.org/libuvc_camera), но для него требуются права суперпользователя или добавление правил udev для конкретного поставщика вашей камеры. Вы, безусловно, можете свободно использовать libuvc\_camera, если вы предпочитаете, особенно если вы уже это делаете.

В предыдущих редакциях этой книги мы использовали отличный драйвер uvc\_cam от Eric Perko. Хотя [uvc\_cam](http://wiki.ros.org/usb_cam) все еще собирается и работает под ROS Indigo, Эрик больше не поддерживает пакет. Так что для этой ревизии мы перейдем к драйверу Bosch usb\_cam, который, похоже, хорошо работает с рядом различных внутренних и внешних веб-камер. Хотя для драйвера есть пакет Ubuntu Debian, нам нужна самая новая исходная установка, которая содержит недавнее усовершенствование. Чтобы установить драйвер из исходного кода, выполните следующие команды:

```text
$ cd ~/catkin_ws/src
$ git clone https://github.com/bosch-ros-pkg/usb_cam.git $ cd ~/catkin_ws
$ catkin_make
$ rospack profile
```

#### _10.3.3 Тестирование вашей камеры Kinect или Xtion_

Установив драйверы openni или freenect, убедитесь, что вы видите видеопоток с камеры с помощью пакета ROS [image\_view](http://wiki.ros.org/image_view). Для Kinect или Xtion сначала подключите камеру к любому доступному USB-порту \(а для Kinect убедитесь, что она подключена к адаптеру 12 В или другим способом\), затем выполните одну из следующих команд:

Для Microsoft Kinect:

```text
$ roslaunch freenect_launch freenect-registered-xyzrgb.launch
```

Для камер Asus Xtion, Xtion Pro или Primesense 1.08 / 1.09:

```text
$ roslaunch openni2_launch openni2.launch depth_registration:=true
```

Если подключение к камере прошло успешно, вы должны увидеть ряд диагностических сообщений, которые выглядят примерно так:

> process\[camera/camera\_nodelet\_manager-1\]: started with pid \[18070\] \[INFO\] \[1420555647.969035762\]: Initializing nodelet with 4 worker threads.  
>  process\[camera/driver-2\]: started with pid \[18078\]

> Warning: USB events thread - failed to set priority. This might cause loss of data...  
>  process\[camera/rectify\_color-3\]: started with pid \[18112\] process\[camera/depth\_rectify\_depth-4\]: started with pid \[18126\]
>
> etc.

**ПРИМЕЧАНИЕ**. Не беспокойтесь, если увидите несколько предупреждений об использовании значений по умолчанию.

Эти сообщения являются нормальными и могут быть проигнорированы. Затем используйте утилиту ROS image\_view для просмотра видеопотока RGB. Цветной видеопоток публикуется в теме ROS / camera / rgb / image\_raw. Для просмотра видео мы запускаем:

```text
$ rosrun image_view image_view image:=/camera/rgb/image_raw
```

Должно появиться небольшое окно дисплея камеры, и после небольшой задержки вы должны увидеть прямую трансляцию видео с вашей камеры. Переместите что-нибудь перед камерой, чтобы убедиться, что изображение обновляется соответствующим образом. Вы можете изменить размер окна изображения с помощью мыши, как и любое другое окно. Как только вы убедитесь, что у вас есть живое видео, закройте окно image\_view или введите Ctrl-C в терминале, с которого вы его запустили.

Чтобы проверить изображение глубины с вашей камеры, запустите image\_view для темы изображения глубины / camera / deep\_registered / image\_rect следующим образом:

```text
$ rosrun image_view image_view image:=/camera/depth_registered/image_rect
```

В этом случае значения оттенков серого на изображении представляют глубину, причем более темные значения указывают точки ближе к камере, а более яркие пиксели представляют точки дальше.

#### _10.3.4 Тестирование вашей веб-камеры USB_

Для USB-камеры нам нужно указать видеоустройство, которое мы хотим использовать. Если у вашего компьютера есть внутренняя камера \(как у многих ноутбуков\), он, вероятно, будет подключен к / dev / video0, а внешне подключенная USB-камера, вероятно, к / dev / video1. Обязательно Ctrl-C из всех файлов запуска openni или freenect, которые вы могли запускать из предыдущего раздела, а затем выполните соответствующую команду ниже в зависимости от видеоустройства вашей веб-камеры:

```text
$ roslaunch rbx1_vision usb_cam.launch video_device:=/dev/video0
```

или

```text
$ roslaunch rbx1_vision usb_cam.launch video_device:=/dev/video1
```

Если соединение установлено успешно, вы должны увидеть поток диагностических сообщений, описывающих различные настройки камеры. Не беспокойтесь, если некоторые из этих сообщений указывают на то, что параметр управления не может быть установлен. Далее используйте утилиту ROS image\_view для просмотра основного видеопотока.

Мы настроили файлы запуска нашей камеры так, чтобы цветной видеопоток был опубликован в теме ROS / camera / rgb / image\_raw. Для просмотра видео мы запускаем:

```text
$ rosrun image_view image_view image:=/camera/rgb/image_raw
```

Должно появиться небольшое окно дисплея камеры, и после небольшой задержки вы должны увидеть прямую трансляцию видео с вашей камеры. Переместите что-нибудь перед камерой, чтобы убедиться, что изображение обновляется соответствующим образом. Вы можете изменить размер окна изображения с помощью мыши, как и любое другое окно. Как только вы убедитесь, что у вас есть живое видео, закройте окно image\_view или введите Ctrl-C в терминале, с которого вы его запустили.

**ПРИМЕЧАНИЕ**. Таким образом, мы можем использовать тот же код ниже для любого типа камеры.

